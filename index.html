<!DOCTYPE html>
<html lang="en" ng-app="fscApp" >
	<head>

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0"; />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
        <meta charset='utf-8' />
        
        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
        <link rel="apple-touch-icon" href="apple-touch-icon-precomposed.png" />
        <link rel="apple-touch-icon-precomposed" href="apple-touch-icon-precomposed.png" />
		<meta http-equiv="cache-control" content="max-age=0" />
		<meta http-equiv="cache-control" content="no-cache" />
		<meta http-equiv="expires" content="0" />
		<meta http-equiv="pragma" content="no-cache" />
		<!--link rel="stylesheet" href="css/main.css"-->


		<style>

		  body {
		  	background-color : lightgray;
		  	padding : 0px;
		  	margin : 0px;
		  }
		  h1 {
		  	color : blue;
		  }
		  p {
		  	color : green;
		  }

		</style>

		<script type="text/javascript">

			var getPixel = function(d, x, y) {

				// do so much thing here!
				d[0] = 0;
				d[1] = 1*y;
				d[2] = 1*y;
				d[3] = 255;

				return d;
			};

			var render = function (ctx, w, h) {

				// loop each pixel render a whole picture
				var drawX = 0;
				var drawY = 0;

				// reusable image data (for faster render)
				var imageData = ctx.getImageData(0, 0, w, h);
				var imageDataData = imageData.data;
				var colorArray = [0, 0, 0, 255];
				var redAt = 0;

				for (drawY = 0; drawY < h; drawY++) {
					for (drawX = 0; drawX < w; drawX++) {

						// ctx.getImageData(0, 0, 1, 1);

						getPixel(colorArray, drawX, drawY);
						imageDataData[redAt] = colorArray[0];
						imageDataData[redAt + 1] = colorArray[1];
						imageDataData[redAt + 2] = colorArray[2];
						imageDataData[redAt + 3] = colorArray[3];
						redAt += 4;

					}
				}

				ctx.putImageData(imageData, 0, 0);
			};

			var init = function () {


				// screen size
				var width = 320;
				var height = 480;
				var scale = 0.5;

				// game canvas and context
				var cav = document.getElementById('game_canvas');
				var ctx = cav.getContext('2d');

				cav.width = width;
				cav.height = height;

				ctx.mozImageSmoothingEnabled = false;
				ctx.msImageSmoothingEnabled = false;
				ctx.imageSmoothingEnabled = false;
				ctx.fillStyle = '#000';
				ctx.fillRect(0, 0, 320, 480);

				// fps counter
				var date = new Date();
				var cft = date.getTime();
				var pft = cft;
				var tl = 0;
				ctx.fillStyle = '#FFF';
				ctx.textAlign = 'left';
				ctx.font='20px Arial';


				var bgCav = document.createElement('canvas');
				var bgCtx = bgCav.getContext('2d');

				bgCav.width = width * scale;
				bgCav.height = height * scale;

				var loop = setInterval(function(){


					// render image
					render(bgCtx, width * scale, height * scale);
	    			ctx.drawImage(bgCav, 0, 0, width, height);

					// render fps
					date = new Date();
					pft = cft;
					cft = date.getTime();
					tl = Math.min(cft - pft, 100);
					date = null;
	    			ctx.fillText('FPS: ' + ~~(1000/tl), 0, 20);

				}, 1000/60);


			};


		</script>

	</head>
	<body onload="init()">
		
		<canvas id="game_canvas"></canvas>

	</body>
</html>